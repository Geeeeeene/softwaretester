# 集成测试 - 终端使用说明

## 前置条件

1. **启动后端服务**
   ```powershell
   # 方式1: 使用启动脚本
   .\启动项目.ps1
   
   # 方式2: 手动启动
   cd backend
   python -m uvicorn app.main:app --reload --port 8000
   ```

2. **确保文件存在**
   - 文件路径: `C:\Users\汤\Desktop\项目测试资料\资料包\程序\utnubu组_源代码\utnubu组_source\diagramscene_ultima.zip`
   - 如果文件在其他位置，请修改脚本中的路径

## 运行测试脚本

```powershell
# 在项目根目录运行
python test_integration.py
```

## 脚本功能

脚本会自动执行以下步骤：

1. **检查后端服务** - 验证后端API是否运行
2. **创建项目** - 创建集成测试项目并上传源代码ZIP文件
3. **生成测试用例** - 使用AI生成Catch2格式的集成测试代码
4. **执行测试** - 编译并运行生成的测试用例
5. **显示结果** - 输出测试统计和详细日志

## 测试结果说明

测试完成后会显示：
- 总用例数
- 通过/失败数量
- 断言统计
- 详细用例列表
- 执行日志

## 注意事项

1. 确保后端服务在 `http://localhost:8000` 运行
2. 确保Claude API Key已配置（用于AI生成测试用例）
3. 确保C++编译环境已安装（用于编译Catch2测试）
4. 集成测试需要被测试的服务正在运行（如果有HTTP API）

## 故障排查

### 问题1: 后端服务未运行
```
[ERROR] 后端服务未运行
```
**解决**: 启动后端服务（见前置条件）

### 问题2: 文件不存在
```
[WARNING] 文件不存在
```
**解决**: 检查文件路径是否正确，或修改脚本中的路径

### 问题3: AI生成失败
```
[ERROR] 生成测试用例失败
```
**解决**: 检查Claude API配置（`backend/app/core/config.py`）

### 问题4: 编译失败
```
[ERROR] 执行测试失败
```
**解决**: 
- 检查C++编译环境
- 查看详细日志了解具体错误
- 确保项目源代码完整

## 自定义测试需求

如果需要修改测试需求，编辑 `test_integration.py` 中的 `test_ir` 配置：

```python
test_ir = {
    "type": "integration",
    "name": "你的测试名称",
    "flow": [
        {
            "name": "端点名称",
            "url": "http://your-api-endpoint",
            "method": "GET",
            ...
        }
    ],
    "validations": [...]
}
```

