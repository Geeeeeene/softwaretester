# 环境配置指南

本指南将帮助您配置项目所需的所有依赖环境。

## 后端环境配置

### 1. 创建Python虚拟环境

在项目根目录下，打开PowerShell或命令提示符，执行：

```powershell
cd backend
python -m venv venv
```

### 2. 激活虚拟环境

**PowerShell:**
```powershell
.\venv\Scripts\Activate.ps1
```

**命令提示符 (CMD):**
```cmd
.\venv\Scripts\activate.bat
```

### 3. 升级pip

```powershell
python -m pip install --upgrade pip
```

### 4. 安装后端依赖

```powershell
pip install -r requirements.txt
```

### 5. 验证安装

检查关键包是否安装成功：

```powershell
pip list | findstr "anthropic fastapi uvicorn"
```

应该能看到这些包及其版本号。

## 前端环境配置

### 1. 进入前端目录

```powershell
cd ..\frontend
```

### 2. 安装前端依赖

```powershell
npm install
```

### 3. 验证安装

检查 `node_modules` 目录是否存在：

```powershell
Test-Path node_modules
```

应该返回 `True`。

## 环境变量配置（可选）

如果需要配置AI API密钥等环境变量，可以在 `backend` 目录下创建 `.env` 文件：

```env
ANTHROPIC_API_KEY=your_api_key_here
DASHSCOPE_API_KEY=your_api_key_here
```

## 常见问题

### 问题1: PowerShell执行策略限制

如果遇到 "无法加载文件，因为在此系统上禁止运行脚本" 的错误，需要修改执行策略：

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### 问题2: 虚拟环境激活失败

确保使用正确的激活脚本：
- PowerShell: `.\venv\Scripts\Activate.ps1`
- CMD: `.\venv\Scripts\activate.bat`

### 问题3: pip安装速度慢

可以使用国内镜像源加速：

```powershell
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 问题4: pip升级权限错误

如果遇到 `[WinError 5] 拒绝访问` 的错误，可以尝试以下解决方案：

**方案1: 跳过升级pip，直接安装依赖（推荐）**
```powershell
# pip 21.2.3 版本足够使用，可以直接安装依赖
pip install -r requirements.txt
```

**方案2: 使用 python -m pip 升级**
```powershell
python -m pip install --upgrade pip --user
```

**方案3: 以管理员身份运行PowerShell**
- 右键点击 PowerShell 图标
- 选择"以管理员身份运行"
- 然后重新执行升级命令

**方案4: 关闭可能占用文件的程序**
- 关闭所有正在运行的 Python 程序
- 关闭 IDE（如 VS Code、PyCharm 等）
- 然后重试

### 问题5: npm安装失败

可以尝试清除缓存后重新安装：

```powershell
npm cache clean --force
npm install
```

## 验证环境配置

配置完成后，可以尝试启动服务：

### 启动后端

```powershell
cd backend
.\venv\Scripts\Activate.ps1
uvicorn app.main:app --reload --port 8000
```

### 启动前端

在另一个终端窗口：

```powershell
cd frontend
npm run dev
```

如果两个服务都能正常启动，说明环境配置成功！

